<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Sparse Grid Integration · SparseGridsKit.jl</title><meta name="title" content="Sparse Grid Integration · SparseGridsKit.jl"/><meta property="og:title" content="Sparse Grid Integration · SparseGridsKit.jl"/><meta property="twitter:title" content="Sparse Grid Integration · SparseGridsKit.jl"/><meta name="description" content="Documentation for SparseGridsKit.jl."/><meta property="og:description" content="Documentation for SparseGridsKit.jl."/><meta property="twitter:description" content="Documentation for SparseGridsKit.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/citations.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="SparseGridsKit.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">SparseGridsKit.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">SparseGridsKit.jl</a></li><li><span class="tocitem">SparseGridsKit.jl by Examples</span><ul><li><a class="tocitem" href="../knots/">Knots</a></li><li><a class="tocitem" href="../misets/">Multi-Index Sets</a></li><li><a class="tocitem" href="../sparsegrids/">Sparse Grids</a></li><li><a class="tocitem" href="../sparsegridinterpolation/">Sparse Grid Interpolation</a></li><li class="is-active"><a class="tocitem" href>Sparse Grid Integration</a><ul class="internal"><li><a class="tocitem" href="#Sparse-Grid-Integration-2"><span>Sparse Grid Integration</span></a></li><li><a class="tocitem" href="#Sparse-Grid-Weighted-L_{\\rho}2(\\Gamma)-Norms"><span>Sparse Grid Weighted L_{\rho}^2(\Gamma) Norms</span></a></li><li><a class="tocitem" href="#Function-Reference"><span>Function Reference</span></a></li></ul></li><li><a class="tocitem" href="../adaptivesparsegrids/">Adaptive Sparse Grids</a></li><li><a class="tocitem" href="../spectralsparsegrids/">Spectral Sparse Grids</a></li><li><a class="tocitem" href="../multifidelity/">Multi-Fidelity Sparse Grid Approximation</a></li></ul></li><li><a class="tocitem" href="../plots/">Plotting</a></li><li><span class="tocitem">Extensions</span><ul><li><a class="tocitem" href="../functioninterpolation/">Interpolation of PDE solutions</a></li><li><a class="tocitem" href="../umbridge/">UM-Bridge</a></li></ul></li><li><a class="tocitem" href="../reference/">SparseGridsKit.jl Public API Reference</a></li><li><a class="tocitem" href="../bib/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">SparseGridsKit.jl by Examples</a></li><li class="is-active"><a href>Sparse Grid Integration</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Sparse Grid Integration</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/benmkent/SparseGridsKit.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/benmkent/SparseGridsKit.jl/blob/main/docs/src/sparsegridintegration.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Sparse-Grid-Integration"><a class="docs-heading-anchor" href="#Sparse-Grid-Integration">Sparse Grid Integration</a><a id="Sparse-Grid-Integration-1"></a><a class="docs-heading-anchor-permalink" href="#Sparse-Grid-Integration" title="Permalink"></a></h1><p>Sparse grid interpolation in <code>SparseGridsKit.jl</code> relies on precomputed integrals of the underlying approximation functions.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>This may change in the future - at the moment precomputing the pairwise integrals is used to speed up computation of <span>$L^2(\Gamma)$</span> type norms.</p></div></div><p>To do this a maximum level number is selected and for each domain dimension, all pairwise <span>$L_{\rho}^2(\Gamma)$</span> integrals inner products are computed using <a href="../sparsegrids/#SparseGridsKit.precompute_lagrange_integrals"><code>precompute_lagrange_integrals</code></a>. For example, we can then extract the pairwise inner products for the level <span>$2$</span> and level <span>$3$</span> polynomials.</p><pre><code class="language-julia hljs">    using SparseGridsKit, LinearAlgebra
    pcl = precompute_lagrange_integrals(7)
    level1 = 2
    level2 = 3
    domaindim = 1
    pcl[domaindim][level1,level2,:,:]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">65×65 Matrix{Float64}:
  0.0380952    0.151424  0.00952381  …  0.0  0.0  0.0  0.0  0.0  0.0  0.0
 -0.00952381   0.152381  0.380952       0.0  0.0  0.0  0.0  0.0  0.0  0.0
  0.0047619   -0.037138  0.00952381     0.0  0.0  0.0  0.0  0.0  0.0  0.0
  0.0          0.0       0.0            0.0  0.0  0.0  0.0  0.0  0.0  0.0
  0.0          0.0       0.0            0.0  0.0  0.0  0.0  0.0  0.0  0.0
  0.0          0.0       0.0         …  0.0  0.0  0.0  0.0  0.0  0.0  0.0
  0.0          0.0       0.0            0.0  0.0  0.0  0.0  0.0  0.0  0.0
  0.0          0.0       0.0            0.0  0.0  0.0  0.0  0.0  0.0  0.0
  0.0          0.0       0.0            0.0  0.0  0.0  0.0  0.0  0.0  0.0
  0.0          0.0       0.0            0.0  0.0  0.0  0.0  0.0  0.0  0.0
  ⋮                                  ⋱            ⋮                   
  0.0          0.0       0.0            0.0  0.0  0.0  0.0  0.0  0.0  0.0
  0.0          0.0       0.0            0.0  0.0  0.0  0.0  0.0  0.0  0.0
  0.0          0.0       0.0            0.0  0.0  0.0  0.0  0.0  0.0  0.0
  0.0          0.0       0.0            0.0  0.0  0.0  0.0  0.0  0.0  0.0
  0.0          0.0       0.0         …  0.0  0.0  0.0  0.0  0.0  0.0  0.0
  0.0          0.0       0.0            0.0  0.0  0.0  0.0  0.0  0.0  0.0
  0.0          0.0       0.0            0.0  0.0  0.0  0.0  0.0  0.0  0.0
  0.0          0.0       0.0            0.0  0.0  0.0  0.0  0.0  0.0  0.0
  0.0          0.0       0.0            0.0  0.0  0.0  0.0  0.0  0.0  0.0</code></pre><p>This precomputation step is generally not too expensive but uses a moderate amount of memory.</p><pre><code class="language-julia hljs">@elapsed precompute_lagrange_integrals(7)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">0.106492874</code></pre><pre><code class="language-julia hljs">sizeof(pcl)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">8</code></pre><p>Additional arguments must be provided to  <a href="../sparsegrids/#SparseGridsKit.precompute_lagrange_integrals"><code>precompute_lagrange_integrals</code></a> if specific knot types are use.</p><h2 id="Sparse-Grid-Integration-2"><a class="docs-heading-anchor" href="#Sparse-Grid-Integration-2">Sparse Grid Integration</a><a class="docs-heading-anchor-permalink" href="#Sparse-Grid-Integration-2" title="Permalink"></a></h2><p>To integrate a sparse grid polynomial approximation we require the sparse grid, function evaluations and the precomputed integrals.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The use of the full precomputed pairwise integrals is overkill here. We only require the weights output by each knot function. This should be optimised in the future.</p></div></div><p>Consider the function <span>$f:[-1,1]\to\mathbb{R}$</span></p><pre><code class="language-julia hljs">    f(x) = @. 3.0*x^2 + 2.0*x + 1.0</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">f (generic function with 1 method)</code></pre><p>and we construct the two-dimension function <span>$[f(x_1), f(x_2)^2]^{\top}$</span> mapping <span>$[-1,1]^2 \to \mathbb{R}^2$</span>. We seek the value of the integral</p><p class="math-container">\[\int_{\Gamma} [f(x_1), f(x_2)^2]^{\top} \rho(x) \textrm{d} x\]</p><p>for a weight function <span>$\rho(x)=0.5^2$</span>.</p><p>The constant approximation is <span>$f(x)\approx[1,1]$</span>. The approximate integral using the constant approximation is equal to <span>$[1,1]$</span>.</p><pre><code class="language-julia hljs">    n,k = 2,0
    mi_set = create_smolyak_miset(n,k)
    pcl = precompute_lagrange_integrals(7)

    sg = create_sparsegrid(mi_set)
    f_on_grid = [[f(x[1]), f(x[2])^2] for x in get_grid_points(sg)]
    # Test integrate_on_sparsegrid
    integral_result = integrate_on_sparsegrid(sg, f_on_grid, pcl)
    integral_result ≈ [1, 1]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">true</code></pre><p>The estimated integral is improved by using a sparse grid with more grid points. The integral can be evaluated explicitly, and it is seen that using an larger sparse grid gets the correct result <span>$[2.0,92/15]$</span>.</p><pre><code class="language-julia hljs">    n,k = 2,4
    mi_set = create_smolyak_miset(n,k)
    sg = create_sparsegrid(mi_set)
    f_on_grid = [[f(x[1]), f(x[2])^2] for x in get_grid_points(sg)]
    # Test integrate_on_sparsegrid
    integral_result = integrate_on_sparsegrid(sg, f_on_grid, pcl)
    integral_result ≈ [2.0,92/15]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">true</code></pre><p>This is of course expected –- the polynomial approximation space represented by the larger sparse grid contains the function  <span>$[f(x_1), f(x_2)^2]$</span>.</p><h2 id="Sparse-Grid-Weighted-L_{\\rho}2(\\Gamma)-Norms"><a class="docs-heading-anchor" href="#Sparse-Grid-Weighted-L_{\\rho}2(\\Gamma)-Norms">Sparse Grid Weighted L_{\rho}^2(\Gamma) Norms</a><a id="Sparse-Grid-Weighted-L_{\\rho}2(\\Gamma)-Norms-1"></a><a class="docs-heading-anchor-permalink" href="#Sparse-Grid-Weighted-L_{\\rho}2(\\Gamma)-Norms" title="Permalink"></a></h2><p>Often the weighted <span>$L_{\rho}^2(\Gamma)$</span> norm is required. Squaring a polynomial approximation results in many higher degree polynomial terms –- it is not as simple as squaring the evaluations at each sparse grid point.</p><p>The precomputed <span>$L_{\rho}^2(\Gamma)$</span> integrals from <a href="../sparsegrids/#SparseGridsKit.precompute_lagrange_integrals"><code>precompute_lagrange_integrals</code></a> are used with the sparse grid approximation structure to <em>exactly</em> compute the <span>$L_{\rho}^2(\Gamma)$</span> norm of a sparse grid polynomial function. These are paired with appropriate pairwise products of the function evaluation which are computed with <a href="../sparsegrids/#SparseGridsKit.precompute_pairwise_norms-Tuple{Any}"><code>precompute_pairwise_norms</code></a>. For example, for a scalar valued function we may require</p><p class="math-container">\[f(x_1) f(x_2) \forall x_1,x_2 \in Z\]</p><p>where <span>$Z$</span> is the set of sparse grid points.</p><p>For example, the function <span>$f(x)=x$</span> has the weighted <span>$L_{\rho}^2([-1,1])$</span> norm equal to </p><p class="math-container">\[\Vert x^2 \Vert_{L_{\rho}^2([-1,1])} = \sqrt{3}\]</p><p>for weight function <span>$\rho=0.5$</span>.</p><pre><code class="language-julia hljs">    n,k = 1,1
    mi_set = create_smolyak_miset(n,k)
    pcl = precompute_lagrange_integrals(7)

    sg = create_sparsegrid(mi_set)
    f_on_grid = [[x[1]] for x in get_grid_points(sg)]
    pairwise_norms = precompute_pairwise_norms(f_on_grid, product=(x,y)-&gt;dot(x,y))
    l2_integral_result = integrate_L2_on_sparsegrid(sg, f_on_grid, pcl)
    l2_integral_result[1] ≈ sqrt(1/3)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">true</code></pre><p>Similarly, for <span>$x^2$</span> we get</p><p class="math-container">\[\Vert x^2 \Vert_{L_{\rho}^2([-1,1])}=\sqrt{5}.\]</p><pre><code class="language-julia hljs">    n,k = 1,3
    mi_set = create_smolyak_miset(n,k)
    pcl = precompute_lagrange_integrals(7)

    sg = create_sparsegrid(mi_set)
    f_on_grid = [[x[1]^2] for x in get_grid_points(sg)]
    l2_integral_result = integrate_L2_on_sparsegrid(sg, f_on_grid, pcl)
    l2_integral_result[1] ≈ sqrt(1/5)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">true</code></pre><p>Finally we consider the <span>$L^2_{\rho}([-1,1]^2)$</span> norm of <span>$f(x_1)$</span>. This can be explicitly computed to be <span>$\sqrt{92/15}$</span>.</p><pre><code class="language-julia hljs">    n,k = 2,4
    mi_set = create_smolyak_miset(n,k)
    pcl = precompute_lagrange_integrals(7)

    sg = create_sparsegrid(mi_set)
    f_on_grid = [f(x[1]) for x in get_grid_points(sg)]
    pairwise_norms = precompute_pairwise_norms(f_on_grid, product=(x,y)-&gt;x.*y)
    l2_integral_result = integrate_L2_on_sparsegrid(sg, f_on_grid, pcl)
    l2_integral_result ≈ sqrt(92/15)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">true</code></pre><p>If the evaluation of the function <span>$f:\Gamma\maps\to\R^n$</span> represents a discrete approximation of a function <span>$F$</span>, we may use a mass matrix <span>$Q$</span> to compute</p><p class="math-container">\[(x_1^{\top} Q x_2)^{1/2} \quad \forall x_1,x_2 \in Z.\]</p><p>This is useful for integrals of the type <span>$L^2_\rho(\Gamma; L^2(D))$</span> where <span>$D$</span> represents the domain of the approximated function <span>$F$</span> and is often seen in the approximation of parametric PDE solutions. This is achieved by passing <code>product=(x,y)-&gt;dot(x,Q,y)</code> as an argument in <a href="../sparsegrids/#SparseGridsKit.precompute_pairwise_norms-Tuple{Any}"><code>precompute_pairwise_norms</code></a>. </p><h2 id="Function-Reference"><a class="docs-heading-anchor" href="#Function-Reference">Function Reference</a><a id="Function-Reference-1"></a><a class="docs-heading-anchor-permalink" href="#Function-Reference" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SparseGridsKit.integrate_on_sparsegrid" href="#SparseGridsKit.integrate_on_sparsegrid"><code>SparseGridsKit.integrate_on_sparsegrid</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">integrate_on_sparsegrid(sg, f_on_grid, precomputed_lagrange_integrals)</code></pre><p>Integrates a function (<code>f_on_grid</code>) over a sparse grid (<code>sg</code>) using precomputed Lagrange integrals.</p><p><strong>Arguments</strong></p><ul><li><code>sg</code>: The sparse grid for integration.</li><li><code>f_on_grid</code>: A vector of function values on the sparse grid.</li><li><code>precomputed_lagrange_integrals</code>: A vector of precomputed Lagrange integrals.</li></ul><p><strong>Returns</strong></p><ul><li>The integral of the function over the sparse grid.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/benmkent/SparseGridsKit.jl/blob/ed68a38bf372e8d6042deaded9636f09c429e06d/src/SparseGridsKit.jl#L185-L197">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SparseGridsKit.integrate_L2_on_sparsegrid" href="#SparseGridsKit.integrate_L2_on_sparsegrid"><code>SparseGridsKit.integrate_L2_on_sparsegrid</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">integrate_L2_on_sparsegrid(sg, f_on_grid, precomputed_lagrange_integrals; product=dot, precomputed_pairwise_norms=nothing)</code></pre><p>Computes the L2 norm of a function (<code>f_on_grid</code>) over a sparse grid (<code>sg</code>) using precomputed integrals.</p><p><strong>Arguments</strong></p><ul><li><code>sg</code>: The sparse grid.</li><li><code>f_on_grid</code>: A vector of function values on the sparse grid.</li><li><code>precomputed_lagrange_integrals</code>: Precomputed Lagrange integrals.</li><li><code>product</code>: A function to compute the inner product (default is <code>dot</code>).</li><li><code>precomputed_pairwise_norms</code>: Optional precomputed norms for optimization.</li></ul><p><strong>Returns</strong></p><ul><li>The L2 norm of the function over the sparse grid.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/benmkent/SparseGridsKit.jl/blob/ed68a38bf372e8d6042deaded9636f09c429e06d/src/SparseGridsKit.jl#L204-L218">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../sparsegridinterpolation/">« Sparse Grid Interpolation</a><a class="docs-footer-nextpage" href="../adaptivesparsegrids/">Adaptive Sparse Grids »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.10.1 on <span class="colophon-date" title="Monday 14 April 2025 07:53">Monday 14 April 2025</span>. Using Julia version 1.11.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
